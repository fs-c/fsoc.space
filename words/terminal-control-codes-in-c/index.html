<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"></meta><meta name="viewport"  content="width=device-width, initial-scale=1"></meta><meta name="author"  content="fsoc"></meta><meta name="author"  content="Laurenz Weixlbaumer"></meta><link href="/styles/base.css"  rel="stylesheet"></link><link href="/styles/font.css"  rel="stylesheet"></link><title>Terminal Control Codes (in C)</title><meta name="description"  content="Using terminal control codes to move the cursor and to draw on the terminal, all from native C code."></meta><link href="/styles/syntax-theme.css"  rel="stylesheet"></link></head><body><div class="min-h-screen flex flex-col h-full "><header class="container border-b border-gray-300 dark:border-gray-600 mt-4 mb-4 pb-4"><div class="prose dark:prose-invert text-black dark:text-white"><a href="/">fsoc</a> / <a href="/words">words</a></div></header><main class="container prose dark:prose-invert lg:prose-lg pb-8"><h1 class="mt-4">Terminal Control Codes (in C)</h1><aside class="mb-4 flex flex-row justify-between"><small>Published on 26/07/2018</small><small><a href="https://github.com/fs-c/fsoc.space/edit/workbench/posts/terminal-control-codes-in-c.md">Edit on github</a></small></aside><p><em>Note that basically nothing in this guide is exclusive to the programming language C, anything that can print to a terminal supporting these sequences will work. It's just the language I happened to use them in.</em></p><p>Many terminals (and terminal emulators) support color and cursor control through a system of escape sequences. A commonly supported and used standard is often referred to as "ANSI Colour", on which the VT100 terminal specification which we will be using is based.</p><p>A terminal control code is a special sequence of characters that is sent to <code>stdout</code> (like any other text). If the terminal understands the code it won't display the sequence, but will perform the action which correlates to the code.</p><p>As an example, the code which can be used to erase the screen looks like <code>&lt;ESC&gt; [ 2J</code> where <code>&lt;ESC&gt;</code> represents the ASCII escape character, 27. Spaces are ignored, and can be added for increased readability.</p><p>A more or less complete list of these sequences can be found on <a href="https://web.archive.org/web/20200413124215/http://www.termsys.demon.co.uk/vtansi.htm">termsys.demon.co.uk</a>, but I'll explain the codes used here as we go along.</p><p>Now, the title says "in C", so here goes:</p><pre><code class="language-c">#include &lt;stdio.h&gt;

#define ASCII_ESC 27

int main()
{
    setbuf(stdout, NULL);
    
	printf("%c[2J", ASCII_ESC);

	return 0;
}</code></pre><p>The above snippet uses the code which was already introduced as an example to clear the screen; its behavior is very similar to the <code>CTRL + L</code> shortcut in bash.</p><p>A very important statement to note is the call to <code>setbuf()</code> in line 7, which disables buffering for stdout.</p><p>Having these control codes strewn about in code can only be considered a bad practice, so we're always going to write abstractions for them. This will help readability and make the code cleaner, not to speak of the fact that remembering and always typing these codes out in full can get very annoying, very quickly.</p><p>One such abstraction, which will come in very handy in the next few examples, could be called <code>move_cursor()</code>.</p><pre><code class="language-c">void move_cursor(int x, int y)
{
	printf("%c[%d;%dH", ASCII_ESC, y, x);
}</code></pre><p>The control code to move the cursor naturally has to accept arguments in the form of line and column numbers, which are passed directly after the <code>[</code> and seperated by semicolons. Note that the control code is defined as <code>[{row};{column}H</code>, which is why we first pass <code>y</code>, followed by <code>x</code>. The arguments to <code>move_cursor()</code> could also be called <code>line</code> and <code>column</code>, but I've found <code>x</code> and <code>y</code> to be more intuitive, not to speak of them being much quicker to type.</p><p>In combination with basic stdio functions we can do a great many things with <code>move_cursor()</code>. For example, drawing a line could be done with the following function.</p><pre><code class="language-c">void draw_line(int slope, int width)
{
	for (int i = 0; i &lt; width; i++) {
		move_cursor(i, (slope * -1) * i);

		putchar('#');
	}
}</code></pre><p>The possibilities are endless, and I don't feel like it would add much value if I would provide more examples here &mdash; for an example use case (and implementation) do feel free to read through the code of <a href="https://github.com/LW2904/vt-space">vt-space</a>, a 2D space shooter in the terminal.</p><script src="https://unpkg.com/prismjs@v1.x/components/prism-core.min.js"></script><script src="https://unpkg.com/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script></main></div><footer class="flex flex-row justify-between prose dark:prose-invert container text-md py-3 mb-1 border-t border-gray-300 dark:border-gray-600 mt-4"><p class="m-0">Built with <a href="https://github.com/fs-c/dhow/tree/rewrite">fs-c/dhow</a>.</p><a href="/legal">imprint & privacy</a></footer></body></html>