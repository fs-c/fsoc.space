<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"></meta><meta name="viewport"  content="width=device-width, initial-scale=1"></meta><meta name="author"  content="fsoc"></meta><meta name="author"  content="Laurenz Weixlbaumer"></meta><link href="/styles/base.css"  rel="stylesheet"></link><title>fsoc.space</title><title>fsoc.space</title><title>fsoc.space</title><title>fsoc.space</title><meta name="description"  content="Reversing an encryptor written in Java, decidedly overusing streams."></meta><link href="/styles/syntax-theme.css"  rel="stylesheet"></link><meta name="description"  content="TODO"></meta><link href="/styles/syntax-theme.css"  rel="stylesheet"></link><meta name="description"  content="Decrypting file contents by reversing the encryption algorithm."></meta><link href="/styles/syntax-theme.css"  rel="stylesheet"></link><meta name="description"  content="I created a GUI for a side project of mine with minimal effort and convenient usage and you can too!"></meta><link href="/styles/syntax-theme.css"  rel="stylesheet"></link><meta name="description"  content="Reversing modern C++ is weird. Purely static analysis to lift out a flag generation algorithm... again!"></meta><link href="/styles/syntax-theme.css"  rel="stylesheet"></link><meta name="description"  content="I can see you! Reading the flag straight from the file."></meta><link href="/styles/syntax-theme.css"  rel="stylesheet"></link></head><body><div class="flex-grow "><header class="container border-b border-gray-300 mt-4 mb-3 pb-1"><div class="prose text-black"><a href="/">fsoc</a> / <a href="/words">words</a></div></header><main class="container prose pb-8"><h1 class="mt-4">CrackMe IV: Behind the Scenes</h1><aside class="mb-4 flex flex-row justify-between"><small>Last edited on 2022-8-19</small><small><a href="https://github.com/fs-c/fsoc.space/edit/workbench/posts/crackme-4-behind-the-scenes.md">Edit on github</a></small></aside><p>This is the <a href="https://app.hackthebox.com/challenges/301">"Behind the Scenes"</a> challenge from hackthebox. The description reads</p><blockquote><p> After struggling to secure our secret strings for a long time, we finally figured out the solution to our problem: Make decompilation harder. It should now be impossible to figure out how our programs work!</p></blockquote><p>Indeed, after opening the ELF binary in IDA and taking a look at <code>main</code>, it looks unusual.</p><pre><code class="language-c">int __cdecl __noreturn main(int argc, const char **argv, const char **envp)
{
  struct sigaction s; // [rsp+10h] [rbp-A0h] BYREF
  unsigned __int64 v4; // [rsp+A8h] [rbp-8h]

  v4 = __readfsqword(0x28u);
  memset(&s, 0, sizeof(s));
  sigemptyset(&s.sa_mask);
  s.sa_handler = (__sighandler_t)segill_sigaction;
  s.sa_flags = 4;
  sigaction(4, &s, 0LL);
  BUG();
}</code></pre><p>I decided to go another route and took a look at the strings embedded in the executable.</p><figure role="img"><img src="https://i.imgur.com/5iI23HL.png" alt=""><figcaption></figcaption></figure><p>We can see what appears to be a usage message and another message that is probably passed to a <code>printf</code>-style function after entering the correct password. But taking a look at the section where these messages are stored,</p><figure role="img"><img src="https://i.imgur.com/wKMym4B.png" alt=""><figcaption></figcaption></figure><p>trivially reveals the password and thus the flag. Yay?</p><h2>Conclusion</h2><p>This one was a bit of a disappointment. The program uses signal handlers (see <a href="https://man7.org/linux/man-pages/man2/sigaction.2.html"><code>sigaction</code></a>), presumably to obfuscate control flow. The actual signal handler, <code>segill_sigaction</code> in the above snippet, looks complicated at first glance so it would have been a fun challenge to reverse how it works. Sadly while decompilation was hard (as promised), finding the flag wasn't.</p><p>I'm still in the process of setting up a proper debugging workflow for ELF binaries. I look forward to finding out how this obfuscation works once I get that done.</p><script src="https://unpkg.com/prismjs@v1.x/components/prism-core.min.js"></script><script src="https://unpkg.com/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script></main></div><footer class="flex flex-row gap-2 prose container text-sm py-2 border-t border-gray-300 mt-4"><span>Built with <a href="https://github.com/fs-c/dhow/tree/rewrite">fs-c/dhow</a>.</span><div class="flex-grow"></div><a href="/imprint">/imprint</a><a href="/privacy">/privacy</a></footer></body></html>